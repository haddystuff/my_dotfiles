version: '3'

tasks:

  init:
    desc: "pre-commit hooks"
    cmds:
      - echo "ðŸš€ Creating virtual environment using uv"
      - uv sync
      - echo "ðŸš€ Installing pre-commit hooks"
      - uv run pre-commit install

  check:
    desc: "Run checks including linting"
    cmds:
      - echo "ðŸš€ Checking lock file consistency with 'pyproject.toml'"
      - uv lock --locked
      - echo "ðŸš€ Static type checking - Running mypy"
      - uv run mypy
      - echo "ðŸš€ Code formatting - Running black"
      - uv run black
{% if "flake8" in linters %}
      - echo "ðŸš€ Linting - Running flake8"
      - uv run flake8 {{ project_slug}} tests
{% endif %}
{% if "ruff" in linters %}
      - echo "ðŸš€ Linting - Running ruff"
      - uv run ruff
{% endif %}

{% if pytest %}
  test:
    desc: "Run tests"
    cmds:
      - echo "ðŸš€ Running tests"
      - uv run python -m pytest {% if codecov %}--cov --cov-config=pyproject.toml{% endif %} tests
{% endif %}

{% if mkdocs %}
  doc-test:
    desc: "Test if documentation can be built without warnings or errors"
    cmds:
      - echo "ðŸš€ Testing documentation"
      - uv run mkdocs build -s

  doc-serve:
    desc: "Serve documentation locally"
    cmds:
      - echo "ðŸš€ Serving documentation"
      - uv run mkdocs serve
{% endif %}